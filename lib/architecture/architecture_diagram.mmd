%% Architecture diagram for Campus-361 (Mermaid)
flowchart TD
  subgraph App Entry
    A[main.dart<br/>initializes Firebase]
  end

  A --> B[WelcomeScreen]
  A --> MainScreen["MainScreen (role-based shell)"]

  B --> Login[LoginScreen]
  B --> GuestMap[CampusMapMainScreen]

  Login -->|Firestore query| Firestore[(Firestore)]
  Login -->|save| LocalUser[LocalUserStore]
  LocalUser --> SharedPrefs[(SharedPreferences)]

  MainScreen --> MapTab[MapTab]
  MapTab --> CampusMapMainScreen[CampusMapMainScreen]

  %% Role dashboards
  MainScreen --> StudentDashboard["StudentDashboard (student/*)"]
  MainScreen --> FacultyDashboard["FacultyDashboard (faculty/*)"]

  StudentDashboard --> StudentTimetable["StudentTimetable (student/student_timetable.dart)"]
  StudentDashboard --> Events["Events (common/events.dart)"]

  FacultyDashboard --> FacultyTimetable["FacultyTimetable (faculty/timetable.dart)"]
  Events --> EventReg["Event Registration (common/event_reg.dart)"]

  %% Events data flows
  Events -->|reads/writes| Firestore

  CampusMapMainScreen --> SlidingPanel["Sliding Panel (From/To UI)"]
  CampusMapMainScreen --> MapPainter["_MapPainter (CustomPainter)"]

  MapPainter --> RoomPositions["roomPositions (normalized coords)"]
  MapPainter --> Graph["Routing Graph (rooms + __VC__)"]
  Graph --> Dijkstra["_dijkstra / Dijkstra"]
  MapPainter --> PathAnim["AnimationController + PathMetrics.extractPath"]
  MapPainter --> Canvas["Canvas drawing (drawRRect, drawPath, TextPainter)"]

  A --> FirebaseOptions[firebase_options.dart]
  A --> Pubspec[pubspec.yaml]

  subgraph PlatformDirs
    android[android/]
    ios[ios/]
    web[web/]
    windows[windows/]
    macos[macos/]
    linux[linux/]
  end

  Pubspec --> PlatformDirs
  Firestore -.-> Pubspec

  classDef core fill:#f9f,stroke:#333,stroke-width:1px;
  class A,MainScreen,MapPainter,Firestore core
